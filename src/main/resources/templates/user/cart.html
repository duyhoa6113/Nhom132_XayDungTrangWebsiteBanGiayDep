<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Giỏ Hàng - NiceSport</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>

    <!-- Custom CSS -->
    <link rel="stylesheet" th:href="@{/css/index.css}"/>
    <link rel="stylesheet" th:href="@{/css/cart.css}"/>
</head>
<body>

<!-- ========== NAVBAR ========== -->
<nav class="navbar navbar-light bg-white shadow-sm sticky-top">
    <!-- Top Bar -->
    <div class="navbar-top">
        <div class="section-wrapper">
            <div class="d-flex justify-content-between align-items-center">
                <div class="top-links">
                    <a href="/seller" class="top-link">Trang chủ</a>
                    <span class="divider">|</span>
                    <a href="/download" class="top-link">Tải ứng dụng</a>
                    <span class="divider">|</span>
                    <span class="top-link">Kết nối</span>
                    <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
                </div>
                <div class="top-links">
                    <a href="#" class="top-link">
                        <i class="far fa-bell me-1"></i>Thông Báo
                    </a>
                    <a href="#" class="top-link">
                        <i class="far fa-question-circle me-1"></i>Hỗ Trợ
                    </a>
                    <a href="#" class="top-link">
                        <i class="fas fa-globe me-1"></i>Tiếng Việt
                        <i class="fas fa-chevron-down ms-1 small"></i>
                    </a>

                    <!-- USER DROPDOWN -->
                    <div th:if="${session.khachHang != null}" class="dropdown d-inline">
                        <a href="#" class="top-link dropdown-toggle" id="userDropdown" data-bs-toggle="dropdown">
                            <i class="far fa-user-circle me-1"></i>
                            <span th:text="${session.khachHang.hoTen}">User</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end user-dropdown-menu shadow-lg">
                            <li class="dropdown-header">
                                <div class="user-info">
                                    <div class="user-avatar-large">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div class="user-details">
                                        <div class="user-name-large" th:text="${session.khachHang.hoTen}">User Name</div>
                                        <div class="user-email" th:text="${session.khachHang.email}">user@example.com</div>
                                    </div>
                                </div>
                            </li>
                            <li><hr class="dropdown-divider m-0"/></li>
                            <li><a class="dropdown-item" href="/profile"><i class="fas fa-user-circle"></i><span>Tài khoản của tôi</span></a></li>
                            <li><a class="dropdown-item" href="/orders"><i class="fas fa-box"></i><span>Đơn hàng</span></a></li>
                            <li><a class="dropdown-item" href="/wishlist"><i class="fas fa-heart"></i><span>Yêu thích</span></a></li>
                            <li><hr class="dropdown-divider m-0"/></li>
                            <li><a class="dropdown-item text-danger" th:href="@{/logout}"><i class="fas fa-sign-out-alt"></i><span>Đăng xuất</span></a></li>
                        </ul>
                    </div>

                    <a th:if="${session.khachHang == null}" th:href="@{/login}" class="top-link">
                        <i class="far fa-user-circle me-1"></i>Đăng nhập
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Navbar -->
    <div class="navbar-main">
        <div class="section-wrapper">
            <div class="row align-items-center w-100 g-3">
                <div class="col-auto">
                    <a class="navbar-brand d-flex align-items-center" th:href="@{/Index}">
                        <div class="logo-icon">
                            <i class="fas fa-running"></i>
                        </div>
                        <span class="logo-text ms-2">NiceSport</span>
                    </a>
                </div>
                <div class="col">
                    <form action="/search" method="get" class="search-form">
                        <div class="search-box-main">
                            <input type="text" name="q" class="search-input-main" placeholder="Tìm giày thể thao, sneaker, sandals..." required="required"/>
                            <button type="submit" class="btn-search-main">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </form>
                </div>
                <div class="col-auto">
                    <a th:href="@{/cart}" class="cart-icon-main position-relative">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-badge-main" th:if="${cartCount != null and cartCount > 0}" th:text="${cartCount}">0</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</nav>

<!-- ========== CART SECTION ========== -->
<div class="cart-section">
    <div class="section-wrapper py-4">

        <!-- Cart Header -->
        <div class="cart-header bg-white p-3 mb-3" style="border-radius: 2px; box-shadow: 0 1px 1px rgba(0,0,0,.05);">
            <div class="row align-items-center">
                <div class="col-5">
                    <div class="d-flex align-items-center gap-3">
                        <input type="checkbox"
                               id="selectAll"
                               class="cart-checkbox"
                               onchange="toggleSelectAll(this)"/>
                        <label for="selectAll" class="mb-0" style="font-size: 14px; cursor: pointer;">
                            Sản Phẩm
                        </label>
                    </div>
                </div>
                <div class="col-2 text-center" style="font-size: 14px; color: #888;">Đơn Giá</div>
                <div class="col-2 text-center" style="font-size: 14px; color: #888;">Số Lượng</div>
                <div class="col-2 text-center" style="font-size: 14px; color: #888;">Số Tiền</div>
                <div class="col-1 text-center" style="font-size: 14px; color: #888;">Thao Tác</div>
            </div>
        </div>

        <!-- Cart Items -->
        <div class="cart-items">
            <!-- Check if cart is empty -->
            <div th:if="${cartItems == null or #lists.isEmpty(cartItems)}" class="empty-cart-message">
                <div class="bg-white text-center py-5" style="border-radius: 2px;">
                    <img src="https://deo.shopeemobile.com/shopee/shopee-pcmall-live-sg/cart/9bdd8040b334d31946f49e36beaf32db.png"
                         alt="Empty Cart"
                         style="width: 100px; opacity: 0.5; margin-bottom: 20px;"/>
                    <p style="font-size: 14px; color: #888;">Giỏ hàng của bạn còn trống</p>
                    <a th:href="@{/Index}" class="btn btn-primary mt-3" style="background: #ee4d2d; border: none; padding: 10px 40px; border-radius: 2px; font-size: 14px;">
                        MUA NGAY
                    </a>
                </div>
            </div>

            <!-- Cart Items List -->
            <div th:if="${cartItems != null and !#lists.isEmpty(cartItems)}">
                <!-- Loop through cart items -->
                <div th:each="item : ${cartItems}"
                     class="cart-item bg-white mb-3 p-3"
                     style="border-radius: 2px; box-shadow: 0 1px 1px rgba(0,0,0,.05);"
                     th:attr="data-item-id=${item.id}">
                    <div class="row align-items-center">
                        <!-- Checkbox & Product Info -->
                        <div class="col-12 col-md-5">
                            <div class="d-flex align-items-center gap-3">
                                <input type="checkbox"
                                       class="cart-checkbox item-checkbox"
                                       th:attr="data-item-id=${item.id},data-price=${item.gia},data-quantity=${item.soLuong}"
                                       onchange="updateCartSummary()"/>
                                <img th:src="${item.hinhAnh}"
                                     th:alt="${item.tenSanPham}"
                                     style="width: 80px; height: 80px; object-fit: cover; border: 1px solid #f0f0f0; border-radius: 2px;"/>
                                <div class="flex-grow-1">
                                    <h6 class="mb-1" style="font-size: 14px; font-weight: 400; line-height: 1.4;">
                                        <span th:text="${item.tenSanPham}">Product Name</span>
                                    </h6>
                                    <p class="mb-0" style="font-size: 12px; color: #888;">
                                        Phân loại: <span th:text="${item.mauSac}">Color</span>, <span th:text="${item.kichThuoc}">Size</span>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Price -->
                        <div class="col-6 col-md-2 text-start text-md-center mt-3 mt-md-0">
                            <div class="d-block d-md-none" style="font-size: 12px; color: #888; margin-bottom: 4px;">Đơn giá:</div>
                            <span th:if="${item.giaGoc != null and item.giaGoc > item.gia}"
                                  class="text-muted text-decoration-line-through d-block"
                                  style="font-size: 12px;">
                                ₫<span th:text="${#numbers.formatDecimal(item.giaGoc, 0, 'COMMA', 0, 'POINT')}">0</span>
                            </span>
                            <div style="font-size: 14px; color: #333;">
                                ₫<span th:text="${#numbers.formatDecimal(item.gia, 0, 'COMMA', 0, 'POINT')}">0</span>
                            </div>
                        </div>

                        <!-- Quantity -->
                        <div class="col-6 col-md-2 text-end text-md-center mt-3 mt-md-0">
                            <div class="d-block d-md-none" style="font-size: 12px; color: #888; margin-bottom: 4px;">Số lượng:</div>
                            <div class="quantity-control d-inline-flex">
                                <button class="qty-btn"
                                        th:onclick="|decreaseQuantity(${item.id})|"
                                        type="button"
                                        style="width: 28px; height: 28px; border: 1px solid #d9d9d9; background: white; cursor: pointer; border-radius: 2px 0 0 2px;">
                                    <i class="fas fa-minus" style="font-size: 10px; color: #888;"></i>
                                </button>
                                <input type="number"
                                       th:value="${item.soLuong}"
                                       th:attr="data-max=${item.maxStock != null ? item.maxStock : 999}"
                                       min="1"
                                       class="qty-input"
                                       th:id="|qty-${item.id}|"
                                       readonly="readonly"
                                       style="width: 40px; height: 28px; text-align: center; border: 1px solid #d9d9d9; border-left: 0; border-right: 0; outline: none; font-size: 14px;"/>
                                <button class="qty-btn"
                                        th:onclick="|increaseQuantity(${item.id})|"
                                        type="button"
                                        style="width: 28px; height: 28px; border: 1px solid #d9d9d9; background: white; cursor: pointer; border-radius: 0 2px 2px 0;">
                                    <i class="fas fa-plus" style="font-size: 10px; color: #888;"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Total Price -->
                        <div class="col-6 col-md-2 text-start text-md-center mt-3 mt-md-0">
                            <div class="d-block d-md-none" style="font-size: 12px; color: #888; margin-bottom: 4px;">Tổng:</div>
                            <span class="item-total"
                                  th:attr="data-item-id=${item.id}"
                                  style="font-size: 16px; color: #ee4d2d; font-weight: 500;">
                                ₫<span th:text="${#numbers.formatDecimal(item.tongTien, 0, 'COMMA', 0, 'POINT')}">0</span>
                            </span>
                        </div>

                        <!-- Actions -->
                        <div class="col-6 col-md-1 text-end mt-3 mt-md-0">
                            <button class="btn-delete"
                                    th:onclick="|deleteItem(${item.id})|"
                                    type="button"
                                    style="background: transparent; border: none; color: #888; cursor: pointer; font-size: 14px;">
                                Xóa
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cart Summary (Sticky) -->
        <div th:if="${cartItems != null and !#lists.isEmpty(cartItems)}"
             class="cart-summary bg-white p-3 mt-3 sticky-bottom"
             style="border-radius: 2px; box-shadow: 0 -2px 10px rgba(0,0,0,.1);">
            <div class="row align-items-center">
                <div class="col-12 col-md-6">
                    <div class="d-flex align-items-center gap-3">
                        <input type="checkbox"
                               id="selectAllBottom"
                               class="cart-checkbox"
                               onchange="toggleSelectAll(this)"/>
                        <label for="selectAllBottom" class="mb-0" style="font-size: 14px; cursor: pointer;">
                            Chọn Tất Cả (<span id="totalItems">0</span>)
                        </label>
                        <button onclick="deleteSelected()"
                                type="button"
                                class="btn-delete ms-3"
                                style="background: transparent; border: none; color: #888; cursor: pointer; font-size: 14px;">
                            Xóa
                        </button>
                    </div>
                </div>
                <div class="col-12 col-md-6 mt-3 mt-md-0">
                    <div class="d-flex align-items-center justify-content-end gap-4">
                        <div class="text-end">
                            <div style="font-size: 14px; color: #888;">
                                Tổng thanh toán (<span id="selectedCount">0</span> Sản phẩm):
                            </div>
                            <div style="font-size: 24px; color: #ee4d2d; font-weight: 500;">
                                ₫<span id="totalAmount">0</span>
                            </div>
                        </div>
                        <button onclick="checkout()"
                                type="button"
                                class="btn btn-checkout"
                                style="background: #ee4d2d; color: white; border: none; padding: 12px 40px; font-size: 14px; border-radius: 2px; min-width: 150px;"
                                disabled="disabled">
                            Mua Hàng
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- ========== FOOTER ========== -->
<footer class="footer-shopee mt-5">
    <div class="footer-top">
        <div class="section-wrapper">
            <div class="row g-4">
                <div class="col-lg-3 col-md-6">
                    <h6 class="footer-heading">CHĂM SÓC KHÁCH HÀNG</h6>
                    <ul class="footer-links">
                        <li><a href="#">Trung Tâm Trợ Giúp</a></li>
                        <li><a href="#">Hướng Dẫn Mua Hàng</a></li>
                        <li><a href="#">Chính Sách Đổi Trả</a></li>
                    </ul>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h6 class="footer-heading">VỀ NICESPORT</h6>
                    <ul class="footer-links">
                        <li><a href="#">Giới Thiệu</a></li>
                        <li><a href="#">Tuyển Dụng</a></li>
                        <li><a href="#">Điều Khoản</a></li>
                    </ul>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h6 class="footer-heading">THANH TOÁN</h6>
                    <div class="payment-methods">
                        <img src="https://down-vn.img.susercontent.com/file/d4bbea4570b93bfd5fc652ca82a262a8" alt="COD"/>
                        <img src="https://down-vn.img.susercontent.com/file/a0a9062ebe19b45c1ae0506f16af5c16" alt="Card"/>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h6 class="footer-heading">THEO DÕI CHÚNG TÔI</h6>
                    <ul class="footer-links">
                        <li><a href="#"><i class="fab fa-facebook me-2"></i>Facebook</a></li>
                        <li><a href="#"><i class="fab fa-instagram me-2"></i>Instagram</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="footer-bottom">
        <div class="section-wrapper">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-2">© 2025 NiceSport. Tất cả các quyền được bảo lưu.</p>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay" style="display: none;">
    <div class="loading-spinner"></div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Cart JavaScript -->
<script th:src="@{/js/cart.js}"></script>

</body>
</html>